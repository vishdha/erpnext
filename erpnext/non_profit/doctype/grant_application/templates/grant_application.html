{% extends "templates/web.html" %}

{% block page_content %}
	<h1>{{ title }}</h1>
	{% if frappe.user == owner %}
		<p><a class='btn btn-primary btn-sm' href="/my-grant?name={{ name }}">Edit Grant</a></p>
	{% endif %}
	<br>
	<table class='table table-bordered small' style='max-width: 400px; margin-bottom: 0px;'>
		<tr>
			<td style='width: 38.2%'>Organization/Indvidual</td>
			<td>{{ title }}</td>
		</tr>
		<tr>
			<td>Grant Applicant Name</td>
			<td>{{ grant_applicant_name }}</td>
		</tr>
		<tr>
			<td>Date</td>
			<td>{{ frappe.format_date(creation) }}</td>
		</tr>
		<tr>
			<td>Status</td>
			<td>{{ status }}</td>
		</tr>
		<tr>
			<td>Email</td>
			<td>{{ email }}</td>
		</tr>
	</table>
	<h2>Q. Please outline your current situation and why you are applying for a grant?</h2>
	<p>	{{ grant_description }}</p>
	<h2>Q. Please Describe the purpose of the grant and how it will benfit your organization?</h2>
	<p>{{ grant_purpose }}</p>
	<h2>Q. Amount Requested Details?</h2>
	<p>{{ amount }}</p>
	<h2>Q. Have you Recevied grant from us before?</h2>
	<p>{{ grant_past_record }}</p>
	<h3>Contact</h3>
	{% if frappe.user != 'Guest' %}
		<table class='table table-bordered small' style='max-width: 400px; margin-bottom: 0px;'>
			<tr>
				<td style='width: 38.2%'>Email</td>
				<td>{{ email }}</td>
			</tr>
		</table>
	{% else %}
		<p><a href="/login">You must register and login to view contact details</a></p>
	{% endif %}
	<br>
	{% if frappe.session.user == assessment_manager %}
		{% if not assessment_scale %}
			<div>
				<form>
					<div class="form-group">
						<label for="scale">Assessment Result (0-10):</label>
						<input type="text" class="form-control" id="scale">
					</div>
					<div class="form-group">
						<label for="note">Note</label>
						<input type="text" class="form-control" id="note">
					</div>
					<button type="button" class="btn btn-default" data-title= "{{ name }}" id="btn-grant-result">Submit</button>
				</form>
			</div>
		{% else %}
			<p> Assessment Review done </p>
		{% endif %}
	{% else %}
	<p><br><a href="/my-grant?new=1" class='btn btn-primary'>Post a New Grant</a></p>
	{% endif %}
	<script>
		frappe.ready(function(title) {
			$(".btn-default").on("click", function() {
				var scale =  $("#scale").val();
				var note = $("#note").val();
				var title = $(this).attr("data-title");
				console.log(scale, note, title);
				frappe.call({
						method: 'erpnext.non_profit.doctype.grant_application.grant_application.assessment_result',
						args: {
							assessment_scale: scale,
							note: note,
							title: title
						},
						callback: function(r) {
							if(r.message) {
								frappe.msgprint(r.message)
							}
						}
				})
			});
		})
	</script>
{% endblock %}